const axios = require('axios');

// Configuration
const STRAPI_URL = 'https://api.sall.technology';
const STRAPI_API_TOKEN = '171dbf0211f374a22ed97a1655dd6f814ca5ce235495bd518349f325b1fe45ca2b007eba8399fdb570271785de56a06b96455cb887555db203ad85c15450b24546a80089e046758c8dadca07334f67a06f92bab9c5e808ef3ec40e0e5acb0eafd830ce92d6663de364915c4b0dd2863e30dd5756b5053727d0aea4bac81ea2c3';

// Fonction principale pour injecter les donn√©es
async function injectServiceData() {
  try {
    console.log('D√©but de l\'injection des donn√©es...');
    
    // Configuration pour les requ√™tes axios
    const config = {
      headers: {
        Authorization: `Bearer ${STRAPI_API_TOKEN}`,
        'Content-Type': 'application/json'
      }
    };
    
    // Pr√©paration des donn√©es avec un slug unique
    const timestamp = Date.now();
    const slug = `applications-mobiles-${timestamp}`;
    
    // Donn√©es du service avec format corrig√© pour Strapi 5
    const serviceData = {
      publishedAt: new Date().toISOString(),
      Titre: "Applications Mobiles en Mauritanie",
      titre_page: "D√©veloppement d'Applications Mobiles √† Nouakchott",
      // Format corrig√© pour rich text fields
      Description: [
        {
          type: "paragraph",
          children: [
            {
              type: "text",
              text: "Des applications mobiles innovantes, performantes et parfaitement adapt√©es aux besoins des entreprises et utilisateurs mauritaniens, d√©velopp√©es par notre √©quipe d'experts √† Nouakchott."
            }
          ]
        }
      ],
      Emoji: "U+1F4F1", // üì±
      Couleur: "from-purple/20 to-purple/5",
      Ordreaffichage: 2,
      slug: slug,
      // Format corrig√© pour rich text fields
      introduction: [
        {
          type: "paragraph",
          children: [
            {
              type: "text",
              text: "Dans un march√© mauritanien o√π plus de 90% des utilisateurs acc√®dent √† internet via leur smartphone, disposer d'une application mobile performante est devenu essentiel pour les entreprises souhaitant se d√©marquer et offrir une exp√©rience optimale √† leurs clients. SALLTECH, bas√©e √† Nouakchott, est votre partenaire privil√©gi√© pour concevoir et d√©velopper des applications mobiles sur mesure, adapt√©es aux sp√©cificit√©s du march√© local."
            }
          ]
        },
        {
          type: "paragraph",
          children: [
            {
              type: "text",
              text: "Notre √©quipe de d√©veloppeurs mauritaniens ma√Ætrise les technologies mobiles les plus avanc√©es (React Native, Flutter, iOS natif, Android natif) pour cr√©er des applications performantes, intuitives et adapt√©es √† tous les appareils. Que vous souhaitiez digitaliser vos services, fid√©liser vos clients ou conqu√©rir de nouveaux march√©s en Mauritanie et dans la sous-r√©gion, nous concevons des solutions mobiles qui r√©pondent pr√©cis√©ment √† vos objectifs business."
            }
          ]
        }
      ],
      caracteristiques: [
        {
          titre: "Applications Cross-Platform",
          description: "D√©veloppement d'applications compatibles avec iOS et Android pour une couverture maximale du march√© mauritanien",
          icone: "U+1F310" // üåê
        },
        {
          titre: "Interfaces Intuitives",
          description: "Design UX/UI adapt√© aux habitudes des utilisateurs mauritaniens et aux sp√©cificit√©s culturelles locales",
          icone: "U+1F3A8" // üé®
        },
        {
          titre: "Performance Optimis√©e",
          description: "Applications l√©g√®res et rapides, parfaitement adapt√©es aux contraintes de r√©seau et aux appareils utilis√©s localement",
          icone: "U+26A1" // ‚ö°
        }
      ],
      types_services: [
        {
          titre: "Applications Professionnelles",
          description: "Solutions mobiles pour les entreprises mauritaniennes souhaitant digitaliser leurs services et optimiser leurs processus",
          icone: "U+1F4BC", // üíº
          fonctionnalites: [
            { texte: "Digitalisation des services et processus internes" },
            { texte: "Applications d'entreprise sur mesure" },
            { texte: "Outils de gestion et de productivit√© mobile" },
            { texte: "Solutions adapt√©es √† votre secteur d'activit√©" }
          ]
        },
        {
          titre: "Applications E-commerce",
          description: "Boutiques mobiles performantes pour vendre vos produits et services sur smartphones et tablettes en Mauritanie",
          icone: "U+1F6D2", // üõí
          fonctionnalites: [
            { texte: "Catalogues produits optimis√©s pour mobile" },
            { texte: "Syst√®mes de paiement adapt√©s au march√© mauritanien" },
            { texte: "Gestion des commandes et notifications" },
            { texte: "Solutions de livraison int√©gr√©es pour Nouakchott" }
          ]
        },
        {
          titre: "Applications Services & M√©dias",
          description: "Applications innovantes pour les entreprises de services, m√©dias et startups mauritaniennes visant √† transformer leur secteur",
          icone: "U+1F4F2", // üì≤
          fonctionnalites: [
            { texte: "Applications de services √† la demande" },
            { texte: "Plateformes m√©dias et de contenu" },
            { texte: "Solutions de r√©servation et de billetterie" },
            { texte: "Applications sociales et communautaires" }
          ]
        }
      ],
      methodologie: [
        {
          numero: 1,
          titre: "Analyse des besoins et du march√© local",
          description: "Nous √©tudions en profondeur votre projet, vos objectifs commerciaux et les sp√©cificit√©s du march√© mobile mauritanien pour d√©finir la strat√©gie optimale.",
          tags: [
            { texte: "√âtude utilisateurs" },
            { texte: "Benchmark concurrentiel" },
            { texte: "Sp√©cifications fonctionnelles" }
          ]
        },
        {
          numero: 2,
          titre: "Conception UX/UI adapt√©e",
          description: "Nous cr√©ons des interfaces intuitives et attrayantes, parfaitement adapt√©es aux habitudes des utilisateurs mauritaniens et aux contraintes locales.",
          tags: [
            { texte: "Wireframes" },
            { texte: "Prototypes interactifs" },
            { texte: "Design responsive" }
          ]
        },
        {
          numero: 3,
          titre: "D√©veloppement technique",
          description: "Notre √©quipe d√©veloppe votre application avec les technologies les plus adapt√©es √† vos besoins et optimis√©es pour les r√©seaux et appareils mauritaniens.",
          tags: [
            { texte: "React Native" },
            { texte: "Flutter" },
            { texte: "D√©veloppement natif" }
          ]
        },
        {
          numero: 4,
          titre: "Tests et assurance qualit√©",
          description: "Nous testons rigoureusement votre application sur diff√©rents appareils et dans les conditions r√©elles d'utilisation en Mauritanie pour garantir une exp√©rience parfaite.",
          tags: [
            { texte: "Tests fonctionnels" },
            { texte: "Tests de performance" },
            { texte: "Tests utilisateurs locaux" }
          ]
        },
        {
          numero: 5,
          titre: "D√©ploiement et suivi",
          description: "Nous assurons la publication de votre application sur les stores, la formation de vos √©quipes, et proposons un accompagnement continu pour faire √©voluer votre solution.",
          tags: [
            { texte: "Publication App Store/Play Store" },
            { texte: "Support technique local" },
            { texte: "Mises √† jour r√©guli√®res" }
          ]
        }
      ],
      technologies: [
        {
          nom: "React Native",
          description: "Framework JavaScript pour d√©velopper des applications iOS et Android √† partir d'une seule base de code"
        },
        {
          nom: "Flutter",
          description: "Framework Google pour cr√©er des applications mobiles natives multi-plateformes"
        },
        {
          nom: "Swift & Kotlin",
          description: "Langages de programmation natifs pour les applications iOS et Android haute performance"
        },
        {
          nom: "Firebase",
          description: "Plateforme de d√©veloppement mobile offrant base de donn√©es temps r√©el, authentification et analytics"
        },
        {
          nom: "API REST & GraphQL",
          description: "Technologies d'int√©gration pour connecter vos applications mobiles √† vos syst√®mes existants"
        },
        {
          nom: "UI/UX Mobile Avanc√©",
          description: "Design d'interfaces innovantes et adapt√©es aux sp√©cificit√©s du march√© mauritanien"
        }
      ],
      faq: [
        {
          question: "Quel est le co√ªt de d√©veloppement d'une application mobile en Mauritanie?",
          reponse: [
            {
              type: "paragraph",
              children: [
                {
                  type: "text",
                  text: "Le co√ªt de d√©veloppement d'une application mobile en Mauritanie varie selon sa complexit√© et les fonctionnalit√©s souhait√©es. Une application simple d√©marre autour de 300 000 MRU, tandis qu'une application complexe avec backend personnalis√© peut atteindre 800 000 MRU ou plus. Nous √©tablissons un devis d√©taill√© et transparent apr√®s avoir analys√© pr√©cis√©ment vos besoins, avec des options adapt√©es √† diff√©rents budgets."
                }
              ]
            }
          ]
        },
        {
          question: "Quelle technologie est la plus adapt√©e pour mon projet d'application mobile?",
          reponse: [
            {
              type: "paragraph",
              children: [
                {
                  type: "text",
                  text: "Le choix de la technologie d√©pend de vos objectifs, de votre budget et des sp√©cificit√©s de votre projet. React Native et Flutter sont id√©ales pour des applications multi-plateformes (iOS et Android) avec un budget ma√Ætris√©, tout en offrant d'excellentes performances. Le d√©veloppement natif (Swift pour iOS, Kotlin pour Android) est recommand√© pour des applications n√©cessitant des performances optimales ou des fonctionnalit√©s avanc√©es sp√©cifiques √† chaque plateforme. Nous vous conseillons la solution la mieux adapt√©e √† vos besoins r√©els et au contexte mauritanien."
                }
              ]
            }
          ]
        },
        {
          question: "Combien de temps faut-il pour d√©velopper une application mobile compl√®te?",
          reponse: [
            {
              type: "paragraph",
              children: [
                {
                  type: "text",
                  text: "Le d√©lai de d√©veloppement d'une application mobile varie g√©n√©ralement de 2 √† 6 mois selon sa complexit√©. Une application simple peut √™tre d√©velopp√©e en 2-3 mois, tandis qu'une solution plus √©labor√©e avec backend personnalis√©, int√©grations multiples et fonctionnalit√©s avanc√©es n√©cessitera 4 √† 6 mois. Notre m√©thodologie agile permet de livrer rapidement des versions interm√©diaires fonctionnelles pour recueillir vos retours et ajuster le d√©veloppement en cons√©quence, assurant ainsi un r√©sultat final parfaitement align√© avec vos attentes."
                }
              ]
            }
          ]
        },
        {
          question: "Comment g√©rez-vous la maintenance et les mises √† jour de l'application apr√®s son lancement?",
          reponse: [
            {
              type: "paragraph",
              children: [
                {
                  type: "text",
                  text: "Nous proposons plusieurs formules de maintenance adapt√©es aux besoins des entreprises mauritaniennes, avec un support technique local. Nos forfaits incluent les mises √† jour de s√©curit√©, la compatibilit√© avec les nouvelles versions d'iOS et Android, les corrections de bugs et les petites am√©liorations. Nous assurons √©galement un monitoring continu pour garantir la performance et la stabilit√© de votre application. Vous pouvez √©galement opter pour un contrat √©volutif permettant d'ajouter r√©guli√®rement de nouvelles fonctionnalit√©s √† votre application pour suivre l'√©volution de vos besoins et du march√©."
                }
              ]
            }
          ]
        }
      ],
      seo: {
        metaTitle: "D√©veloppement d'Applications Mobiles √† Nouakchott | SALLTECH Mauritanie",
        metaDescription: "Agence de d√©veloppement d'applications mobiles iOS et Android √† Nouakchott. Solutions sur mesure pour entreprises mauritaniennes. Devis gratuit!",
        keywords: "applications mobiles Mauritanie, d√©veloppement app Nouakchott, React Native Mauritanie, Flutter Mauritanie, applications iOS Nouakchott, applications Android Mauritanie, d√©veloppeurs mobile Nouakchott"
      }
    };
    
    // Cr√©ation du service
    console.log('Cr√©ation d\'un nouveau service avec slug:', slug);
    try {
      const createResponse = await axios.post(
        `${STRAPI_URL}/api/services`,
        { data: serviceData },
        config
      );
      
      console.log('Service cr√©√© avec succ√®s!');
      console.log('ID du nouveau service:', createResponse.data.data.id);
      console.log('Slug du nouveau service:', slug);
      
      return { success: true, serviceId: createResponse.data.data.id };
    } catch (error) {
      console.error('Erreur lors de l\'injection des donn√©es:', error.message);
      
      if (error.response && error.response.data) {
        console.error('D√©tails de l\'erreur:', JSON.stringify(error.response.data, null, 2));
        
        if (error.response.data?.error?.details?.errors) {
          console.error('Erreurs sp√©cifiques:', JSON.stringify(error.response.data.error.details.errors, null, 2));
        }
      }
      
      throw error;
    }
  } catch (error) {
    console.error('Le script a √©chou√©:', error.message);
    return { success: false, error };
  }
}

// Ex√©cuter la fonction principale
injectServiceData()
  .then((result) => {
    if (result.success) {
      console.log('Processus termin√© avec succ√®s!');
    } else {
      console.error('Le script a √©chou√©');
      process.exit(1);
    }
  })
  .catch((error) => {
    console.error('Erreur finale:', error);
    process.exit(1);
  });